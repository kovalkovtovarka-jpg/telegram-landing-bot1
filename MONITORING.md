# Мониторинг и алерты для админов

Кратко: как настроить уведомления администраторов в Telegram.

---

## 1. Кто получает алерты

Все пользователи из **BOT_ADMIN_IDS** (переменная окружения, ID через запятую). Узнать свой ID: команда `/myid` в боте.

---

## 2. Уведомление при старте бота

После каждого запуска (polling или webhook) бот может отправить админам сообщение вида: «Бот запущен (webhook) 2025-02-14 12:00:00 UTC».

**Включение:** в `.env` или в Railway Variables добавьте:

```env
NOTIFY_ADMINS_ON_STARTUP=1
```

(или `true` / `yes`). После деплоя или перезапуска админы получат такое сообщение.

---

## 3. Алерт при критической ошибке запуска

Если при старте бота произойдёт необработанное исключение (после создания экземпляра бота), админам уйдёт сообщение вида:

«Критическая ошибка при запуске бота (polling): …»

Отправка идёт из `main.py` и `webhook.py` при падении в `except Exception`, если к этому моменту бот уже создан.

---

## 4. Алерт при падении деплоя в GitHub Actions

Если workflow **Deploy to Railway** завершится с ошибкой, в Telegram можно отправить сообщение: «Деплой на Railway упал. Проверьте вкладку Actions».

**Настройка:**

1. В GitHub: репозиторий → **Settings** → **Secrets and variables** → **Actions**.
2. Добавьте секреты (если их ещё нет):
   - **TELEGRAM_BOT_TOKEN** — токен вашего бота (тот же, что в Railway).
   - **TELEGRAM_ADMIN_CHAT_ID** — ваш Telegram ID (число) или ID группы, куда слать алерт. Можно использовать тот же ID, что в `BOT_ADMIN_IDS`.

Если один из секретов не задан, шаг уведомления просто не отправляет сообщение (деплой при этом не ломается).

---

## 5. Использование в коде (для разработчиков)

Чтобы отправить произвольное сообщение всем админам из бота:

```python
await self.notify_admins("Текст алерта")
```

Метод `notify_admins` у экземпляра бота уже учитывает `BOT_ADMIN_IDS` и не падает при ошибке отправки одному из админов.

---

## Итог

| Событие              | Откуда              | Условие |
|----------------------|----------------------|--------|
| Старт бота           | Бот                  | `NOTIFY_ADMINS_ON_STARTUP=1` |
| Критическая ошибка   | main.py / webhook.py | Бот уже создан до падения   |
| Падение деплоя       | GitHub Actions       | Заданы TELEGRAM_BOT_TOKEN и TELEGRAM_ADMIN_CHAT_ID |

Все алерты уходят в личку или группу, указанную в **BOT_ADMIN_IDS** (для старта и ошибок) и в **TELEGRAM_ADMIN_CHAT_ID** (для падения деплоя).
