═══════════════════════════════════════════════════════════════
ДЕТАЛЬНАЯ АРХИТЕКТУРА TELEGRAM LANDING BOT
═══════════════════════════════════════════════════════════════

═══════════════════════════════════════════════════════════════
ОБЩАЯ СХЕМА РАБОТЫ
═══════════════════════════════════════════════════════════════

Пользователь (Telegram)
    ↓
Telegram API
    ↓
Telegram Bot (python-telegram-bot)
    ↓
┌─────────────────────────────────────┐
│  Backend (Python приложение)        │
│  ┌───────────────────────────────┐  │
│  │ 1. Сбор данных пользователя   │  │
│  │    (через диалог в Telegram)  │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 2. Сохранение в БД            │  │
│  │    (SQLite/PostgreSQL)        │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 3. Построение промпта        │  │
│  │    (prompt_builder)           │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 4. Генерация кода через LLM  │  │
│  │    (OpenAI/Claude/Gemini)     │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 5. Валидация и сохранение     │  │
│  │    (HTML, CSS, JS, PHP)       │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 6. Создание ZIP архива        │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
    ↓
Отправка ZIP пользователю в Telegram


═══════════════════════════════════════════════════════════════
НЕОБХОДИМЫЕ СЕРВИСЫ И ПРОГРАММЫ
═══════════════════════════════════════════════════════════════

1. TELEGRAM BOT API (ОБЯЗАТЕЛЬНО)

Что это:
- Официальный API от Telegram для создания ботов
- Позволяет боту получать сообщения и отправлять ответы

Как получить:
1. Откройте Telegram
2. Найдите бота @BotFather
3. Отправьте команду /newbot
4. Следуйте инструкциям
5. Получите токен вида: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz

Где используется:
- backend/config.py → TELEGRAM_BOT_TOKEN
- backend/bot/telegram_bot.py → создание бота

Стоимость: Бесплатно


2. LLM (LARGE LANGUAGE MODEL) - ОБЯЗАТЕЛЬНО

Что это:
- Нейросеть, которая генерирует HTML/CSS/JS код лендинга
- Бот поддерживает 3 провайдера на выбор

2.1. OpenAI GPT-4o (РЕКОМЕНДУЕТСЯ)

Что это:
- Нейросеть от OpenAI
- Модель: gpt-4o (самая новая и мощная)

Как получить:
1. Зайдите на platform.openai.com
2. Создайте аккаунт или войдите
3. Перейдите в API Keys
4. Нажмите "Create new secret key"
5. Сохраните ключ (показывается только один раз!)

Где используется:
- backend/config.py → OPENAI_API_KEY
- backend/generator/llm_client.py → генерация кода

Стоимость: Платно (~$0.01-0.03 за генерацию лендинга)
- GPT-4o: ~$5 за 1M токенов входных, ~$15 за 1M токенов выходных
- Один лендинг: ~5000-8000 токенов = ~$0.05-0.15

Альтернативы:
- gpt-4-turbo - дешевле, но менее качественно
- gpt-3.5-turbo - очень дешево, но низкое качество

2.2. Anthropic Claude (АЛЬТЕРНАТИВА)

Что это:
- Нейросеть от Anthropic
- Модель: claude-3-5-sonnet-20241022

Как получить:
1. Зайдите на console.anthropic.com
2. Создайте аккаунт
3. Перейдите в API Keys
4. Создайте новый ключ

Где используется:
- backend/config.py → ANTHROPIC_API_KEY
- backend/generator/llm_client.py → генерация кода

Стоимость: Платно (~$0.015 за 1K токенов входных, ~$0.075 за 1K выходных)

2.3. Google Gemini (АЛЬТЕРНАТИВА)

Что это:
- Нейросеть от Google
- Модель: gemini-1.5-pro

Как получить:
1. Зайдите на makersuite.google.com/app/apikey
2. Создайте API ключ

Где используется:
- backend/config.py → GOOGLE_API_KEY
- backend/generator/llm_client.py → генерация кода

Стоимость: Платно (бесплатный лимит, потом платно)

Рекомендация: OpenAI GPT-4o - лучшее качество и стабильность


3. БАЗА ДАННЫХ (ОБЯЗАТЕЛЬНО)

Что это:
- Хранилище данных пользователей, проектов, истории генераций

3.1. SQLite (для разработки/тестирования)

Что это:
- Встроенная база данных в файле
- Не требует установки отдельного сервера

Где используется:
- backend/database/database.py → DATABASE_URL=sqlite:///landing_bot.db
- Автоматически создается при первом запуске

Стоимость: Бесплатно

Ограничения:
- Не подходит для продакшн (много пользователей)
- Один файл на диске

3.2. PostgreSQL (для продакшн - РЕКОМЕНДУЕТСЯ)

Что это:
- Профессиональная база данных
- Поддерживает много одновременных пользователей

Варианты получения:

A. Облачные сервисы (бесплатные планы):

1. ElephantSQL (бесплатно до 20MB)
   - elephantsql.com
   - Создайте аккаунт → Create Instance → Tiny Turtle (FREE)
   - Скопируйте Connection String

2. Supabase (бесплатно до 500MB)
   - supabase.com
   - Создайте проект → Settings → Database
   - Скопируйте Connection String

3. Neon (бесплатно до 3GB)
   - neon.tech
   - Создайте проект → скопируйте Connection String

B. Свой сервер:
- Установите PostgreSQL на VPS
- Создайте базу данных и пользователя

Где используется:
- backend/config.py → DATABASE_URL=postgresql://user:pass@host:5432/db
- backend/database/database.py → подключение

Стоимость: Бесплатно (облачные планы) или платно (свой сервер)


4. PYTHON ОКРУЖЕНИЕ (ОБЯЗАТЕЛЬНО)

Что это:
- Язык программирования, на котором написан бот
- Версия: Python 3.8 или выше (рекомендуется 3.10+)

Как установить:
1. Скачайте с python.org
2. Установите (отметьте "Add Python to PATH")
3. Проверьте: python --version

Где используется:
- Весь проект написан на Python
- main.py - точка входа

Стоимость: Бесплатно


5. PYTHON БИБЛИОТЕКИ (ОБЯЗАТЕЛЬНО)

Что это:
- Готовые модули для работы с Telegram, LLM, БД

Список (из requirements.txt):

1. python-telegram-bot==20.7
   - Работа с Telegram Bot API
   - Обработка сообщений, кнопок, команд

2. openai==1.6.0
   - Клиент для OpenAI API
   - Генерация кода через GPT

3. anthropic==0.18.1
   - Клиент для Anthropic API
   - Генерация через Claude

4. google-generativeai==0.3.2
   - Клиент для Google Gemini API

5. sqlalchemy==2.0.23
   - Работа с базами данных
   - ORM (объектно-реляционное отображение)

6. psycopg2-binary==2.9.9
   - Драйвер для PostgreSQL

7. python-dotenv==1.0.0
   - Загрузка переменных из .env файла

8. aiohttp==3.9.1
   - Асинхронные HTTP запросы
   - Для webhook режима

9. httpx==0.25.2
   - HTTP клиент

10. python-dateutil==2.8.2
    - Работа с датами

Как установить:
pip install -r requirements.txt

Стоимость: Бесплатно


6. ХОСТИНГ/СЕРВЕР (ОБЯЗАТЕЛЬНО для продакшн)

Что это:
- Место, где будет работать бот 24/7

Варианты:

6.1. VPS (Virtual Private Server)

Что это:
- Виртуальный сервер с полным контролем
- Ubuntu/Debian Linux

Провайдеры:
- DigitalOcean ($6/месяц)
- Hetzner ($4/месяц)
- AWS EC2 (от $5/месяц)
- Vultr ($6/месяц)

Что нужно:
- SSH доступ
- Python 3.8+
- PostgreSQL (опционально)

6.2. Railway

Что это:
- Платформа для деплоя приложений
- Автоматический деплой из GitHub

Стоимость: Бесплатный план (ограниченный) или $5/месяц

Особенности:
- Автоматический деплой
- Встроенный PostgreSQL
- Простая настройка

6.3. Render

Что это:
- Платформа для деплоя приложений
- Поддержка Python

Стоимость: Бесплатный план или $7/месяц

6.4. Heroku

Что это:
- Платформа для деплоя
- Простая настройка

Стоимость: От $7/месяц (бесплатный план отменен)

6.5. DigitalOcean App Platform

Что это:
- Управляемая платформа
- Автоматический деплой

Стоимость: От $5/месяц

Рекомендация: Railway или Render для начала (проще всего)


═══════════════════════════════════════════════════════════════
КАК ВСЕ ВЗАИМОДЕЙСТВУЕТ
═══════════════════════════════════════════════════════════════

Сценарий 1: Пользователь создает лендинг

1. Пользователь → Telegram → /create
   ↓
2. Бот (telegram_bot.py) → собирает данные через диалог
   ↓
3. Данные сохраняются → БД (UserState модель)
   ↓
4. Пользователь подтверждает → /confirm_generate
   ↓
5. code_generator.py → строит промпт (prompt_builder.py)
   ↓
6. llm_client.py → отправляет запрос в OpenAI/Claude/Gemini
   ↓
7. LLM возвращает код → HTML, CSS, JS, PHP
   ↓
8. code_generator.py → валидирует и сохраняет файлы
   ↓
9. Создается ZIP архив
   ↓
10. Бот отправляет ZIP → пользователю в Telegram


Сценарий 2: Хранение данных

Пользователь вводит данные
    ↓
telegram_bot.py → _save_user_data()
    ↓
database.py → SessionLocal
    ↓
PostgreSQL/SQLite → таблица user_states
    ↓
Данные сохраняются в JSON формате


Сценарий 3: Генерация кода

Собранные данные пользователя
    ↓
prompt_builder.py → build_prompt()
    ↓
Создается детальный промпт для LLM
    ↓
llm_client.py → generate_landing()
    ↓
HTTP запрос → OpenAI API / Anthropic API / Google API
    ↓
LLM обрабатывает промпт
    ↓
Возвращает JSON с кодом
    ↓
llm_client.py → парсит ответ
    ↓
code_generator.py → сохраняет файлы


═══════════════════════════════════════════════════════════════
КОМПОНЕНТЫ ПРОЕКТА
═══════════════════════════════════════════════════════════════

1. main.py - Точка входа
- Запускает бота
- Инициализирует БД
- Обрабатывает ошибки

2. backend/bot/telegram_bot.py - Основной бот
- Обработка команд (/start, /create, /quick)
- Управление диалогами
- Сохранение данных пользователя
- Запуск генерации

3. backend/bot/handlers/ - Обработчики этапов
- hero_handler.py - сбор данных hero блока
- product_handler.py - название и характеристики
- timer_handler.py - настройка таймера
- price_handler.py - цены
- form_handler.py - опции формы
- middle_block_handler.py - средний блок
- description_handler.py - описание
- reviews_handler.py - отзывы
- footer_handler.py - подвал
- notification_handler.py - уведомления

4. backend/generator/code_generator.py - Генератор кода
- Оркестрация процесса генерации
- Вызов LLM
- Валидация кода
- Сохранение файлов
- Создание ZIP

5. backend/generator/llm_client.py - Клиент LLM
- Поддержка OpenAI, Anthropic, Google
- Отправка запросов в API
- Парсинг ответов
- Обработка ошибок

6. backend/generator/prompt_builder.py - Построитель промптов
- Создание детальных промптов для LLM
- Обработка данных пользователя
- Поддержка старой и новой структуры

7. backend/database/database.py - Работа с БД
- Подключение к БД
- Создание сессий
- Управление соединениями

8. backend/database/models.py - Модели данных
- User - пользователи
- Project - проекты
- Generation - история генераций
- UserState - состояние диалога

9. backend/utils/ - Утилиты
- text_processor.py - обработка текста (Wildberries)
- rate_limiter.py - ограничение запросов


═══════════════════════════════════════════════════════════════
СТОИМОСТЬ РАБОТЫ БОТА
═══════════════════════════════════════════════════════════════

Минимальная конфигурация (для тестирования):
- Telegram Bot API - Бесплатно
- SQLite - Бесплатно
- Python - Бесплатно
- OpenAI API - ~$0.05-0.15 за лендинг
- Хостинг (Railway/Render) - Бесплатно (ограниченный план)

Итого: ~$0.05-0.15 за каждый сгенерированный лендинг

Продакшн конфигурация:
- Telegram Bot API - Бесплатно
- PostgreSQL (облачный) - Бесплатно (до лимита) или $7-15/месяц
- Python - Бесплатно
- OpenAI API - ~$0.05-0.15 за лендинг
- Хостинг - $5-10/месяц

Итого: ~$5-25/месяц + $0.05-0.15 за каждый лендинг


═══════════════════════════════════════════════════════════════
МИНИМАЛЬНЫЙ НАБОР ДЛЯ ЗАПУСКА
═══════════════════════════════════════════════════════════════

Для локального тестирования:
1. Python 3.8+
2. Telegram Bot Token
3. OpenAI API Key
4. SQLite (встроен в Python)

Для продакшн:
1. Python 3.8+
2. Telegram Bot Token
3. OpenAI API Key (или другой LLM)
4. PostgreSQL (облачный или свой)
5. Хостинг (Railway/Render/VPS)


═══════════════════════════════════════════════════════════════
ДОПОЛНИТЕЛЬНЫЕ РЕСУРСЫ
═══════════════════════════════════════════════════════════════

Документация:
- python-telegram-bot: docs.python-telegram-bot.org
- OpenAI API: platform.openai.com/docs
- Anthropic API: docs.anthropic.com
- SQLAlchemy: docs.sqlalchemy.org

Полезные ссылки:
- Telegram Bot API: core.telegram.org/bots/api
- PostgreSQL Tutorial: postgresqltutorial.com


═══════════════════════════════════════════════════════════════
ЧАСТЫЕ ВОПРОСЫ
═══════════════════════════════════════════════════════════════

Q: Можно ли использовать бот без LLM?
A: Нет, LLM обязателен для генерации кода лендинга.

Q: Можно ли использовать бесплатный LLM?
A: Нет, все LLM провайдеры платные, но есть бесплатные кредиты при регистрации.

Q: Нужен ли свой сервер?
A: Нет, можно использовать облачные платформы (Railway, Render).

Q: Сколько стоит один лендинг?
A: ~$0.05-0.15 в зависимости от размера и провайдера LLM.

Q: Можно ли использовать SQLite в продакшн?
A: Не рекомендуется, лучше PostgreSQL для надежности.


═══════════════════════════════════════════════════════════════
МИГРАЦИЯ БАЗЫ ДАННЫХ
═══════════════════════════════════════════════════════════════

Вопрос: Легко ли сменить облачную БД на свой PostgreSQL?

Ответ: Да, очень легко!

Почему это просто:

1. SQLAlchemy ORM - все запросы идут через абстракцию, а не напрямую SQL
2. Одна переменная - достаточно изменить DATABASE_URL
3. Автоматическая схема - SQLAlchemy создаст таблицы автоматически

Процесс миграции:

1. Экспорт данных из старой БД (скрипт migrate_db.py - см. ANSWERS_AND_IMPLEMENTATION.md)
2. Импорт данных в новую БД (автоматически)
3. Изменение DATABASE_URL в .env или переменных окружения
4. Перезапуск бота - всё работает!

Время миграции: 10-15 минут
Простой: Минимальный (только во время миграции)

Подробная инструкция: См. ANSWERS_AND_IMPLEMENTATION.md (раздел "Вопрос 1")


═══════════════════════════════════════════════════════════════
ПРЕДВАРИТЕЛЬНЫЙ ПРОСМОТР ЛЕНДИНГА
═══════════════════════════════════════════════════════════════

Вопрос: Можно ли показать предпросмотр перед выдачей ZIP?

Ответ: Да, можно реализовать!

Варианты реализации:

1. Telegram Web App (РЕКОМЕНДУЕТСЯ)
- Встроенный браузер в Telegram
- Просмотр без выхода из приложения
- Удобно для пользователя

2. Временный хостинг + ссылка
- Загрузка на Netlify/Vercel/GitHub Pages
- Отправка ссылки пользователю
- Полный контроль

3. Скриншот лендинга
- Генерация изображения через headless браузер
- Отправка картинки
- Быстро, но только статическое изображение

4. HTML файл в Telegram
- Отправка HTML как файла
- Пользователь открывает в браузере
- Просто, но ограниченно

План реализации:

1. После генерации → показать кнопку "Предпросмотр"
2. Пользователь открывает → видит лендинг
3. Кнопки: "Всё ОК" / "Внести правки"
4. Если ОК → отправка ZIP
5. Если правки → цикл редактирования

Подробная инструкция: См. ANSWERS_AND_IMPLEMENTATION.md (раздел "Вопрос 2")


═══════════════════════════════════════════════════════════════
ГОТОВО! ТЕПЕРЬ ВЫ ПОНИМАЕТЕ ВСЮ АРХИТЕКТУРУ БОТА!
═══════════════════════════════════════════════════════════════

