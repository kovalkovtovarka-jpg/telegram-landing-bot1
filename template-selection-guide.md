# Руководство по логике выбора шаблона

## Обзор

Логика выбора шаблона определяет оптимальный шаблон лендинга на основе ответов пользователя. Процесс проходит в несколько этапов через decision tree или через быстрый выбор по ключевым словам.

## Структура выбора

### 1. Пошаговый выбор (Decision Tree)

Процесс состоит из 4 шагов:

#### Шаг 1: Тип товара
**Вопрос**: "Что вы продаете?"

**Варианты**:
- Физический товар → переход к шагу 2
- Услуга → переход к шагу 2 (с предложением `service_consultation`)
- Цифровой товар → переход к шагу 2 (с предложением `digital_course`)

#### Шаг 2: Бизнес-модель
**Вопрос** (для физического товара): "Как вы продаете товар?"

**Варианты**:
- Один товар → `physical_single`
- Товар с вариантами → `physical_multi`
- Дропшиппинг → `physical_dropshipping`

#### Шаг 3: Ценовой диапазон
**Вопрос**: "Какая цена товара/услуги?"

**Варианты**:
- До 100 BYN → `low_price_impulse`
- 100-500 BYN → `medium_price_justified`
- 500+ BYN → `high_price_detailed`

#### Шаг 4: Особые сценарии
**Вопрос**: "Есть ли особые условия?"

**Варианты** (можно выбрать несколько):
- Ограниченное предложение → добавляет элементы срочности
- Предзаказ → `pre_order` (высокий приоритет)
- Сезонный товар → модифицирует дизайн
- Продажа бизнесу → `b2b` (высший приоритет)
- Нет особых условий

### 2. Быстрый выбор (Quick Selection)

Анализ текста пользователя по ключевым словам:

```javascript
const text = "Хочу создать лендинг для ортопедической подушки со скидкой";
const result = selector.quickSelect(text);
// Результат: physical_single + limited_offer
```

## Приоритеты выбора

### Приоритет 1: Особые сценарии (Override)
Эти шаблоны имеют высший приоритет и переопределяют другие:

1. **B2B** - всегда использует `b2b` шаблон
2. **Предзаказ** - всегда использует `pre_order` шаблон
3. **Ограниченное предложение** - модифицирует базовый шаблон

### Приоритет 2: Бизнес-модель
Определяет базовую структуру:

- `physical_dropshipping` - для дропшиппинга
- `physical_multi` - для товаров с вариантами
- `physical_single` - для одного товара

### Приоритет 3: Ценовая категория
Влияет на стиль и глубину описания:

- `low_price_impulse` - минимализм, срочность
- `medium_price_justified` - баланс описания и срочности
- `high_price_detailed` - максимум информации

## Правила выбора

### Правило 1: Дропшиппинг
```
Если: физический товар + дропшиппинг + цена (низкая/средняя)
То: physical_dropshipping
```

### Правило 2: Товар с вариантами
```
Если: физический товар + варианты + цена (средняя/высокая)
То: physical_multi
```

### Правило 3: Ценовая категория
```
Если: физический товар + один товар + цена низкая
То: low_price_impulse

Если: физический товар + один товар + цена средняя
То: medium_price_justified

Если: физический товар + один товар + цена высокая
То: high_price_detailed
```

### Правило 4: Особые сценарии
```
Если: есть "ограниченное предложение"
То: limited_offer (модифицирует базовый шаблон)

Если: есть "предзаказ"
То: pre_order (standalone)

Если: есть "b2b"
То: b2b (standalone, переопределяет все)
```

## Матрица совместимости

### Совместимые комбинации:

| Базовый шаблон | Совместимые сценарии |
|----------------|---------------------|
| `physical_single` | `limited_offer`, `seasonal` |
| `physical_multi` | `limited_offer`, `seasonal` |
| `physical_dropshipping` | `limited_offer`, `seasonal` |
| `service_consultation` | `limited_offer` |
| `digital_course` | `limited_offer` |
| `low_price_impulse` | `limited_offer`, `seasonal` |
| `medium_price_justified` | `limited_offer`, `seasonal` |

### Несовместимые комбинации:

| Базовый шаблон | Несовместимые сценарии |
|----------------|----------------------|
| Все физические товары | `pre_order`, `b2b` |
| Услуги/Курсы | `pre_order`, `seasonal`, `b2b` |

## Примеры использования

### Пример 1: Простая продажа подушки

**Вопросы**:
1. Что продаете? → Физический товар
2. Как продаете? → Один товар
3. Какая цена? → 99 BYN (низкая)
4. Особые условия? → Нет

**Результат**: `low_price_impulse`

**Обоснование**: Низкий чек требует импульсного подхода с элементами срочности.

---

### Пример 2: Товар с вариантами размера

**Вопросы**:
1. Что продаете? → Физический товар
2. Как продаете? → Товар с вариантами
3. Какая цена? → 250 BYN (средняя)
4. Особые условия? → Нет

**Результат**: `physical_multi`

**Обоснование**: Варианты выбора требуют селектора и динамического изменения цены.

---

### Пример 3: Акция на товар

**Вопросы**:
1. Что продаете? → Физический товар
2. Как продаете? → Один товар
3. Какая цена? → 149 BYN (средняя)
4. Особые условия? → Ограниченное предложение

**Результат**: `limited_offer` (базовый: `medium_price_justified`)

**Обоснование**: Акция добавляет элементы срочности к базовому шаблону.

---

### Пример 4: Предзаказ новинки

**Вопросы**:
1. Что продаете? → Физический товар
2. Как продаете? → Один товар
3. Какая цена? → 299 BYN (средняя)
4. Особые условия? → Предзаказ

**Результат**: `pre_order`

**Обоснование**: Предзаказ имеет высокий приоритет и требует специального шаблона.

---

### Пример 5: B2B продажи

**Вопросы**:
1. Что продаете? → Физический товар
2. Как продаете? → Один товар
3. Какая цена? → 500 BYN (высокая)
4. Особые условия? → Продажа бизнесу

**Результат**: `b2b`

**Обоснование**: B2B имеет высший приоритет и переопределяет все остальные условия.

## Интеграция в чат-бот

### Вариант 1: Пошаговые вопросы

```javascript
const selector = new TemplateSelector(templates, selectionLogic);

// Шаг 1
const question1 = selector.getNextQuestion();
bot.sendMessage(chatId, question1.question);

// Получение ответа
selector.setAnswer(question1.stepId, userAnswer);
const question2 = selector.getNextQuestion();

// ... и так далее до получения шаблона
```

### Вариант 2: Быстрый выбор

```javascript
const userText = "Хочу лендинг для подушки со скидкой";
const quickResult = selector.quickSelect(userText);

if (quickResult) {
  // Уточняем детали для найденного шаблона
  bot.sendMessage(chatId, `Нашел подходящий шаблон: ${quickResult.template}`);
} else {
  // Переходим к пошаговым вопросам
  startStepByStepSelection();
}
```

### Вариант 3: Гибридный подход

```javascript
// Пытаемся быстрый выбор
let result = selector.quickSelect(userText);

if (!result || result.confidence === 'low') {
  // Если не уверены, уточняем критичные параметры
  const criticalQuestions = [
    'Какова цена товара?',
    'Есть ли варианты выбора?',
    'Это акция или обычная продажа?'
  ];
  // Задаем вопросы и используем пошаговый выбор
}
```

## Обработка конфликтов

### Конфликт 1: B2B + Предзаказ
**Решение**: B2B имеет приоритет → `b2b`

### Конфликт 2: Сезонный + Предзаказ
**Решение**: Предзаказ имеет приоритет → `pre_order`

### Конфликт 3: Низкая цена + Высокий чек шаблон
**Решение**: Используется шаблон по ценовой категории → `low_price_impulse`

## Рекомендации для улучшения

1. **Машинное обучение**: Накапливать статистику выбора и корректировать правила
2. **A/B тестирование**: Предлагать несколько вариантов и отслеживать конверсию
3. **Кастомизация**: Позволять пользователю вручную выбрать шаблон
4. **Предпросмотр**: Показывать примеры шаблонов перед выбором
5. **Гибридные шаблоны**: Комбинировать элементы разных шаблонов

## API для чат-бота

### Методы TemplateSelector:

```javascript
// Получить следующий вопрос
getNextQuestion() → { type: 'question', question: string, options: array }

// Задать ответ
setAnswer(questionId, answer) → nextQuestion

// Выбрать шаблон
selectTemplate() → { type: 'template', template: string, reason: string }

// Быстрый выбор
quickSelect(text) → { type: 'template', template: string, confidence: string }

// Получить информацию о шаблоне
getTemplateInfo(templateId) → template object

// Проверить совместимость
checkCompatibility(baseTemplate, specialScenarios) → { compatible: boolean, warnings: array }

// Получить модификации
getRecommendedModifications(templateId, specialScenarios) → modifications array
```
